<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Odometer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0/jquery.min.js" integrity="sha512-lzilC+JFd6YV8+vQRNRtU7DOqv5Sa9Ek53lXt/k91HZTJpytHS1L6l1mMKR9K6VVoDt4LiEXaa6XBrYk1YhGTQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="src/odometer.min.js"></script>
    <link rel="stylesheet" href="src/odometer-theme-minimal.css" />
    <style>
        body{
            height: 100vh;
            background-color: white;
            color: black;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }
        body.dark{
            background-color: black;
            color: white;
        }
        .box{
            display: flex;
            align-items: center;
            font-family: Arial, Helvetica, sans-serif;
            font-weight: bold;
            font-size: 128px;   
        }

        p.odom{
            display: flex;
        }

        .tutorial h3{
            font-family: Arial, Helvetica, sans-serif;
            font-size: 28px;
            border-bottom: 1px solid black;
            transition: all 0.3s ease-in-out;
            cursor: pointer;
        }
        .tutorial h3:hover{
            color: red;
            border-bottom: 1px solid red;
        }
    </style>
    </head>
    <body class="darks">
        <div class="box">
            <p id="odometer-h" class="odom" style="display: none;">
                <span id="odometer-h1">0</span>
                <span id="odometer-h2">0</span>:
            </p>
            <p id="odometer-m" class="odom" style="display: none;">
                <span id="odometer-m1">0</span>
                <span id="odometer-m2">0</span>:
            </p>
            <p id="odometer-s" class="odom" style="display: none;">
                <span id="odometer-s1">0</span>
                <span id="odometer-s2">0</span>
            </p>
        </div>
        <div class="tutorial">
            <h3 onclick="openTutorial()">How to setup ?</h3>
        </div>
        <script>

       function init() {
    odometerOptions = { auto: false }; // Disables auto-initialization
    const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);
    const darkModeSet = urlParams.get("dark");
    let timeTimer = urlParams.get("time");
    let timeHours = urlParams.get("hours");
    let timeMin = urlParams.get("min");
    let timeSec = urlParams.get("sec");

    if (darkModeSet === "true") {
        $("body").addClass("dark");
    }

    if (timeTimer) {
        countdown(timeTimer);
    } else {
        // fallback values
        if (!timeSec) timeSec = "00";
        if (!timeMin) timeMin = "00";
        if (!timeHours) timeHours = "00";
        let time = timeHours + ":" + timeMin + ":" + timeSec;
        countdown(time);
    }
}

function countdown(time) {
    $(".tutorial h3").text("Loading timer ...");
    $(".tutorial").fadeOut(650);

    // Create odometer instances
    const odometer_h1 = new Odometer({ el: $('#odometer-h1')[0], value: 0, theme: 'default' });
    const odometer_h2 = new Odometer({ el: $('#odometer-h2')[0], value: 0, theme: 'default' });
    const odometer_m1 = new Odometer({ el: $('#odometer-m1')[0], value: 0, theme: 'default' });
    const odometer_m2 = new Odometer({ el: $('#odometer-m2')[0], value: 0, theme: 'default' });
    const odometer_s1 = new Odometer({ el: $('#odometer-s1')[0], value: 0, theme: 'default' });
    const odometer_s2 = new Odometer({ el: $('#odometer-s2')[0], value: 0, theme: 'default' });

    // Parse time
    const timeParts = time.split(':');
    let hours = parseInt(timeParts[0], 10);
    let minutes = parseInt(timeParts[1], 10);
    let seconds = parseInt(timeParts[2], 10);

    // Calculate total seconds
    let totalSeconds = hours * 3600 + minutes * 60 + seconds;

    setTimeout(function () {
        $("#odometer-h").removeAttr("style");
        $("#odometer-m").removeAttr("style");
        $("#odometer-s").removeAttr("style");
    }, 1200);

    // Countdown interval
    const interval = setInterval(function () {
        if (totalSeconds < 0) {
            clearInterval(interval);
            console.log('Countdown complete!');
            return;
        }

        hours = Math.floor(totalSeconds / 3600);
        minutes = Math.floor((totalSeconds % 3600) / 60);
        seconds = totalSeconds % 60;

        const newHours = hours.toString().padStart(2, '0');
        const newMinutes = minutes.toString().padStart(2, '0');
        const newSeconds = seconds.toString().padStart(2, '0');

        // Hours
        if (hours === 0) {
            $("#odometer-h").css("display", "none");
        } else {
            odometer_h1.update(Number(newHours[0]));
            odometer_h2.update(Number(newHours[1]));
        }

        // Minutes
        odometer_m1.update(Number(newMinutes[0]));
        odometer_m2.update(Number(newMinutes[1]));

        // Seconds
        odometer_s1.update(Number(newSeconds[0]));
        odometer_s2.update(Number(newSeconds[1]));

        totalSeconds--;
    }, 1000);
}

        function openTutorial(){
            window.open("setup", "loadingTutorial", "toolbar=no,scrollbars=no,resizable=no,top=200,left=500,width=520,height=400")
        }
        
        $(function () {
            init();
        });
    </script>
</body>
</html>